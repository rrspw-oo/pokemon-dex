import{e,_ as t,s as i,g as a,a as n,b as r,c as s,h as o,d as c}from"./pokemon-utils-ZukTi9IR.js";const l="https://pokeapi.co/api/v2";const h=new class{constructor(e=100){this.maxSize=e,this.cache=new Map}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}has(e){return this.cache.has(e)}clear(){this.cache.clear()}size(){return this.cache.size}}(100),m=new Map;function g(e,t=!1){return t?"/pokemonBall.svg":`data:image/svg+xml;charset=UTF-8,${encodeURIComponent(`\n    <svg width="64" height="64" xmlns="http://www.w3.org/2000/svg" style="image-rendering: pixelated;">\n      <rect width="64" height="64" fill="#e0e0e0" stroke="#999" stroke-width="1"/>\n      <rect x="8" y="8" width="48" height="48" fill="#f5f5f5" stroke="#ccc" stroke-width="1"/>\n      <circle cx="20" cy="24" r="3" fill="#333"/>\n      <circle cx="44" cy="24" r="3" fill="#333"/>\n      <rect x="28" y="32" width="8" height="4" fill="#666" rx="2"/>\n      <text x="32" y="52" text-anchor="middle" dominant-baseline="central"\n            font-family="monospace" font-size="8" fill="#666">\n        ${e?e.substring(0,6):"???"}\n      </text>\n    </svg>\n  `)}`}function u(e){if(!e)return!1;const t=e.toString().trim();if(!t)return!1;if(/^\d+$/.test(t)){const e=parseInt(t);return e>=1&&e<=1025}if(!/^[a-zA-Z\s\-.']+$/.test(t))return!1;return!/[ㄅ-ㄭㄱ-ㅎㅏ-ㅣ가-힣一-龯]/.test(t)}async function f(e){if(!u(e))throw new Error(`Invalid Pokemon identifier: ${e}`);const t=`pokemon_${e}`;return h.has(t)?h.get(t):async function(e,t){if(m.has(e))return m.get(e);const i=t();m.set(e,i);try{const t=await i;return m.delete(e),t}catch(a){throw m.delete(e),a}}(t,async()=>{try{const i=e.toString().toLowerCase().trim(),n=await fetch(`${l}/pokemon/${i}`);if(!n.ok)throw new Error(`Pokemon not found: ${e}`);const c=await n.json(),m=await a(c.id,c.name),g=await s(c.id,c.name),u=r(c.id,c.name),f={id:c.id,name:c.name,chineseName:m,englishName:g,image:c.sprites?.versions?.["generation-viii"]?.icons?.front_default||c.sprites?.other?.["official-artwork"]?.front_default||u.primary,imageFallback:c.sprites?.front_default||u.fallback,imageAlternatives:u.alternatives,isLocalSprite:u.isLocal,hasLocalSprite:o(),originalImage:c.sprites?.other?.["official-artwork"]?.front_default||c.sprites?.front_default,shinyImage:c.sprites?.versions?.["generation-vii"]?.["ultra-sun-ultra-moon"]?.front_shiny||c.sprites?.versions?.["generation-viii"]?.icons?.front_shiny||c.sprites?.other?.["official-artwork"]?.front_shiny||c.sprites?.front_shiny,hasShinySprite:!!(c.sprites?.versions?.["generation-vii"]?.["ultra-sun-ultra-moon"]?.front_shiny||c.sprites?.versions?.["generation-viii"]?.icons?.front_shiny||c.sprites?.other?.["official-artwork"]?.front_shiny||c.sprites?.front_shiny),hasPixelShiny:!(!c.sprites?.versions?.["generation-vii"]?.["ultra-sun-ultra-moon"]?.front_shiny&&!c.sprites?.versions?.["generation-viii"]?.icons?.front_shiny),types:c.types.map(e=>({name:e.type.name,chinese:p(e.type.name)})),height:c.height,weight:c.weight,stats:c.stats.map(e=>({name:e.stat.name,value:e.base_stat})),spriteDebugInfo:u.debugInfo};return h.set(t,f),f}catch(i){const t=c(e)||`未知寶可夢 (${e})`,a=r(e,t,!0);return{id:parseInt(e)||0,name:e.toString(),chineseName:t,englishName:e.toString(),image:a.placeholder||a.fallback,imageFallback:a.placeholder||a.fallback,imageAlternatives:a.alternatives||[],isLocalSprite:!1,hasLocalSprite:o(),shinyImage:null,hasShinySprite:!1,types:[],height:0,weight:0,stats:[],error:!0,errorMessage:`無法載入寶可夢資料: ${i.message}`,spriteDebugInfo:a.debugInfo}}})}async function d(t,r=!1,s=null){if(null===s&&(s=1===t.length?100:10),!t||t.length<1)return[];const o=i(t);if(o.length>0)return o.map(e=>({id:e.id,name:e.name_en,englishName:e.name_en,chineseName:e.name_zh_tw,types:e.types.map(e=>({name:e.toLowerCase(),chinese:p(e.toLowerCase())})),stats:e.stats,total_stats:e.total_stats,image:e.image,shinyImage:e.shinyImage,gmaxImage:e.gmaxImage,hasShinySprite:e.hasShinySprite,hasGmaxForm:e.hasGmaxForm,is_variant:e.is_variant,is_custom:!0,error:!1}));const c=`search_${t}_${r}_${s}`;if(h.has(c))return h.get(c);try{if(await e(),/^\d+$/.test(t)){const e=parseInt(t,10);if(!u(e))throw new Error(`Invalid Pokemon ID: ${e}`);const i=await fetch(`${l}/pokemon-species/${e}`);if(!i.ok)throw new Error(`Species not found for ID: ${e}`);const n=await i.json(),s=n.id,o=n.varieties.map(e=>e.pokemon.name).map(async e=>{try{const t=await f(e);return t.id=s,t.chineseName=await a(t.id,e),t.is_variant="oricorio-baile"!==e,t}catch(t){return null}});let g=(await Promise.all(o)).filter(e=>null!==e&&!e.error);if(0===g.length)throw new Error(`No forms found for ID ${e}`);if(r&&g.length>0)try{const t=await y(e),i=g.map(e=>e.englishName?.toLowerCase()||e.name?.toLowerCase()),a=t.filter(e=>{const t=e.englishName?.toLowerCase()||e.name?.toLowerCase();return!i.includes(t)&&!e.error});g=[...g,...a],g.sort((e,t)=>e.id-t.id)}catch(m){}return h.set(c,g),g}const i=n(t);if(i.length>0){const e=[],t=new Set,a=i.slice(0,Math.min(s,5)).map(async e=>{if(t.has(e.id))return null;t.add(e.id);try{const t=await fetch(`${l}/pokemon-species/${e.id}`);if(t.ok){const i=(await t.json()).varieties.map(e=>e.pokemon.name).filter(e=>!["-totem","-starter","-battle-bond"].some(t=>e.includes(t)));return i.length>1?i.map(t=>({id:e.id,name:t,isForm:!0})):1===i.length?[{id:e.id,name:i[0],isForm:!1}]:[{id:e.id,name:e.en.toLowerCase(),isForm:!1}]}return[{id:e.id,name:e.id.toString(),isForm:!1}]}catch(i){return[{id:e.id,name:e.id.toString(),isForm:!1}]}});(await Promise.all(a)).forEach(t=>{t&&e.push(...t)});const n=e.map(async e=>{try{const t=await f(e.name);return t.id=e.id,t}catch(t){return null}}),o=(await Promise.all(n)).filter(e=>null!==e&&!e.error),m=[],g=new Set;for(const i of o){const e=`${i.id}-${i.chineseName}`;g.has(e)||(g.add(e),m.push(i))}let u=m.slice(0,s);if(r&&u.length>0&&u.length<=3){const e=u.map(async e=>{try{return(await y(e.id)).filter(t=>t.id!==e.id&&!t.error)}catch(t){return[]}}),t=(await Promise.all(e)).flat(),i=[...u,...t],a=new Set;u=i.filter(e=>{const t=`${e.id}-${e.englishName||e.name}`;return!a.has(t)&&!e.error&&(a.add(t),!0)}),u.sort((e,t)=>e.id-t.id),u=u.slice(0,s)}return h.set(c,u),u}if(!u(t))return h.set(c,[]),[];try{const e=await f(t);if(e.error)return h.set(c,[]),[];let i=[e];if(r)try{const t=(await y(e.id)).filter(t=>t.id!==e.id&&!t.error);i=[...i,...t],i.sort((e,t)=>e.id-t.id)}catch(m){}return h.set(c,i),i}catch(g){return h.set(c,[]),[]}}catch(g){return h.set(c,[]),[]}}function p(e){return{normal:"一般",fire:"火",water:"水",electric:"電",grass:"草",ice:"冰",fighting:"格鬥",poison:"毒",ground:"地面",flying:"飛行",psychic:"超能力",bug:"蟲",rock:"岩石",ghost:"幽靈",dragon:"龍",dark:"惡",steel:"鋼",fairy:"妖精"}[e.toLowerCase()]||e}async function w(e){const t=`evolution_${e}`;if(h.has(t))return h.get(t);try{const i=await fetch(`${l}/pokemon-species/${e}`);if(!i.ok)throw new Error(`Species not found: ${e}`);const a=(await i.json()).evolution_chain.url,n=await fetch(a);if(!n.ok)throw new Error("Evolution chain not found");const r=function(e){const t=[];function i(e,a=0){const n=e.species.name,r=function(e){const t=e.match(/\/(\d+)\/$/);return t?parseInt(t[1]):null}(e.species.url),s=e.evolution_details[0]||{},o=s.trigger?.name||null,c=s.min_level||null,l=s.item?.name||null,h=s.min_happiness||null,m=s.time_of_day||null,g={id:r,name:n,stage:a,evolutionTrigger:o,minLevel:c,item:l,minHappiness:h,timeOfDay:m,chineseName:null,englishName:null,image:null};t.push(g),e.evolves_to&&e.evolves_to.length>0&&e.evolves_to.forEach(e=>{i(e,a+1)})}return i(e),t}((await n.json()).chain);return h.set(t,r),r}catch(i){return[]}}async function y(e){try{const t=(await w(e)).map(async e=>{try{const t=await f(e.id);return{...e,chineseName:t.chineseName,englishName:t.englishName,image:t.image,types:t.types,shinyImage:t.shinyImage,hasShinySprite:t.hasShinySprite,imageFallback:t.imageFallback,imageAlternatives:t.imageAlternatives,isLocalSprite:t.isLocalSprite,hasLocalSprite:t.hasLocalSprite,originalImage:t.originalImage,height:t.height,weight:t.weight,stats:t.stats}}catch(t){return{...e,chineseName:`未知寶可夢 ${e.id}`,englishName:e.name,image:g(e.name,!0),types:[],shinyImage:null,hasShinySprite:!1,imageFallback:g(e.name,!0),imageAlternatives:[],isLocalSprite:!1,hasLocalSprite:!1,originalImage:null,height:0,weight:0,stats:[],error:!0}}});return await Promise.all(t)}catch(t){return[]}}function v(e){return{normal:"#A8A878",fire:"#F08030",water:"#6890F0",electric:"#F8D030",grass:"#78C850",ice:"#98D8D8",fighting:"#C03028",poison:"#A040A0",ground:"#E0C068",flying:"#A890F0",psychic:"#F85888",bug:"#A8B820",rock:"#B8A038",ghost:"#705898",dragon:"#7038F8",dark:"#705848",steel:"#B8B8D0",fairy:"#EE99AC"}[e.toLowerCase()]||"#68A090"}async function S(t){const i=`forms_${t}`;if(h.has(i))return h.get(i);try{await e();const o=parseInt(t),c=[],m=new Set;try{const e=await y(o);for(const t of e)t.error||m.has(t.id)||(m.add(t.id),c.push(t))}catch(a){}try{const e=await fetch(`${l}/pokemon-species/${o}`);if(e.ok){const t=(await e.json()).varieties||[];for(const e of t)try{const t=e.pokemon.name;if(["-totem","-starter","-battle-bond"].some(e=>t.includes(e)))continue;const i=await f(t);if(i.error)continue;i.id=o,i.is_api_variant=!0;const a=r(i.id,t);t.includes("-mega")||t.includes("-gmax")?(i.image=i.originalImage||a.primary,i.imageFallback=i.sprites?.front_default||a.fallback):(i.image=a.primary,i.imageFallback=a.fallback),i.imageAlternatives=a.alternatives,i.isLocalSprite=a.isLocal;c.find(e=>e.id===i.id&&e.englishName===i.englishName)||c.push(i)}catch(n){}}}catch(s){}return h.set(i,c),c}catch(o){try{const e=[await f(t.toString())];return h.set(i,e),e}catch(c){return h.set(i,[]),[]}}}async function _(i,a=5){try{await e();const{getSearchSuggestions:n,isValidSearchQuery:r}=await t(async()=>{const{getSearchSuggestions:e,isValidSearchQuery:t}=await import("./pokemon-utils-ZukTi9IR.js").then(e=>e.p);return{getSearchSuggestions:e,isValidSearchQuery:t}},[]);return r&&r(i)&&n?n(i,a):[]}catch(n){return[]}}e().catch(()=>{});export{v as a,S as b,_ as g,d as s};
