<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寶可夢搜尋器 - Pokemon Search</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="完整的寶可夢圖鑑搜尋工具，支援離線使用，包含1025+隻寶可夢">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="寶可夢圖鑑">
    <meta name="msapplication-TileColor" content="#764ba2">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/icon-192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/icon-16.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .search-box {
            text-align: center;
            margin-bottom: 30px;
        }

        #searchInput {
            width: 60%;
            max-width: 400px;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s;
        }

        #searchInput:focus {
            border-color: #667eea;
        }

        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .pokemon-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .pokemon-image {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pokemon-image img {
            max-width: 70px;
            max-height: 70px;
        }

        .pokemon-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .pokemon-name-en {
            color: #666;
            font-size: 0.9em;
        }

        .pokemon-id {
            color: #999;
            font-size: 0.8em;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            color: #666;
            margin: 20px 0;
            font-size: 1.1em;
        }

        .loading-progress {
            width: 60%;
            max-width: 400px;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 10px auto;
            overflow: hidden;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .loading-text {
            margin-top: 10px;
            font-size: 0.9em;
        }

        .no-results {
            text-align: center;
            color: #999;
            margin: 40px 0;
            font-size: 1.2em;
        }

        .load-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 18px;
            margin: 5px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .load-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .load-btn:active {
            transform: translateY(0);
        }

        .load-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* PWA 樣式 */
        .install-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            padding: 8px 16px;
            margin-left: 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
            transition: transform 0.2s;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .install-btn:hover {
            transform: scale(1.05);
        }

        .update-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #4CAF50;
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .update-banner button {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            cursor: pointer;
        }

        /* 離線指示器 */
        .offline-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #ff9800;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .install-btn {
                display: block;
                margin: 10px auto 0;
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 寶可夢搜尋器</h1>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="搜尋寶可夢名稱 (中文/英文/編號)..." />
            <div id="loadingOptions" style="margin-top: 15px;">
                <div style="margin-bottom: 10px; color: #666; font-size: 0.9em;">選擇載入範圍：</div>
                <button id="loadPartial" class="load-btn">載入前251隻（第1-2代）</button>
                <button id="loadMore" class="load-btn">載入前493隻（第1-4代）</button>
                <button id="loadAll" class="load-btn">載入全1025隻（全部）</button>
            </div>
        </div>
        <div id="loading" class="loading" style="display: none;">
            <div>載入寶可夢資料中...</div>
            <div class="loading-progress">
                <div id="loadingBar" class="loading-bar"></div>
            </div>
            <div id="loadingText" class="loading-text">0 / 251</div>
        </div>
        <div id="pokemonGrid" class="pokemon-grid"></div>
        <div id="noResults" class="no-results" style="display: none;">找不到相符的寶可夢</div>
    </div>

    <script>
        class PokemonSearch {
            constructor() {
                this.pokemonData = [];
                this.allPokemon = [];
                this.loadedCount = 0;
                this.totalCount = 251; // 初始載入數量
                this.maxCount = 1025; // 最大數量
                this.isOnline = navigator.onLine;
                this.searchInput = document.getElementById('searchInput');
                this.pokemonGrid = document.getElementById('pokemonGrid');
                this.loading = document.getElementById('loading');
                this.loadingBar = document.getElementById('loadingBar');
                this.loadingText = document.getElementById('loadingText');
                this.noResults = document.getElementById('noResults');
                
                // 完整中文名稱對照表（第一、二代寶可夢）
                this.chineseNames = {
                    'bulbasaur': '妙蛙種子',
                    'ivysaur': '妙蛙草',
                    'venusaur': '妙蛙花',
                    'charmander': '小火龍',
                    'charmeleon': '火恐龍',
                    'charizard': '噴火龍',
                    'squirtle': '傑尼龜',
                    'wartortle': '卡咪龜',
                    'blastoise': '水箭龜',
                    'caterpie': '綠毛蟲',
                    'metapod': '鐵甲蛹',
                    'butterfree': '巴大蝶',
                    'weedle': '獨角蟲',
                    'kakuna': '鐵殼蛹',
                    'beedrill': '大針蜂',
                    'pidgey': '波波',
                    'pidgeotto': '比比鳥',
                    'pidgeot': '大比鳥',
                    'rattata': '小拉達',
                    'raticate': '拉達',
                    'spearow': '烈雀',
                    'fearow': '大嘴雀',
                    'ekans': '阿柏蛇',
                    'arbok': '阿柏怪',
                    'pikachu': '皮卡丘',
                    'raichu': '雷丘',
                    'sandshrew': '穿山鼠',
                    'sandslash': '穿山王',
                    'nidoran-f': '尼多蘭',
                    'nidorina': '尼多娜',
                    'nidoqueen': '尼多后',
                    'nidoran-m': '尼多朗',
                    'nidorino': '尼多力諾',
                    'nidoking': '尼多王',
                    'clefairy': '皮皮',
                    'clefable': '皮可西',
                    'vulpix': '六尾',
                    'ninetales': '九尾',
                    'jigglypuff': '胖丁',
                    'wigglytuff': '胖可丁',
                    'zubat': '超音蝠',
                    'golbat': '大嘴蝠',
                    'oddish': '走路草',
                    'gloom': '臭臭花',
                    'vileplume': '霸王花',
                    'paras': '派拉斯',
                    'parasect': '派拉斯特',
                    'venonat': '毛球',
                    'venomoth': '摩魯蛾',
                    'diglett': '地鼠',
                    'dugtrio': '三地鼠',
                    'meowth': '喵喵',
                    'persian': '貓老大',
                    'psyduck': '可達鴨',
                    'golduck': '哥達鴨',
                    'mankey': '猴怪',
                    'primeape': '火爆猴',
                    'growlithe': '卡蒂狗',
                    'arcanine': '風速狗',
                    'poliwag': '蚊香蝌蚪',
                    'poliwhirl': '蚊香君',
                    'poliwrath': '蚊香泳士',
                    'abra': '凱西',
                    'kadabra': '勇基拉',
                    'alakazam': '胡地',
                    'machop': '腕力',
                    'machoke': '豪力',
                    'machamp': '怪力',
                    'bellsprout': '喇叭芽',
                    'weepinbell': '口呆花',
                    'victreebel': '大食花',
                    'tentacool': '瑪瑙水母',
                    'tentacruel': '毒刺水母',
                    'geodude': '小拳石',
                    'graveler': '隆隆石',
                    'golem': '隆隆岩',
                    'ponyta': '小火馬',
                    'rapidash': '烈焰馬',
                    'slowpoke': '呆呆獸',
                    'slowbro': '呆殼獸',
                    'magnemite': '小磁怪',
                    'magneton': '三合一磁怪',
                    'farfetchd': '大蔥鴨',
                    'doduo': '嘟嘟',
                    'dodrio': '嘟嘟利',
                    'seel': '小海獅',
                    'dewgong': '白海獅',
                    'grimer': '臭泥',
                    'muk': '臭臭泥',
                    'shellder': '大舌貝',
                    'cloyster': '刺甲貝',
                    'gastly': '鬼斯',
                    'haunter': '鬼斯通',
                    'gengar': '耿鬼',
                    'onix': '大岩蛇',
                    'drowzee': '催眠貘',
                    'hypno': '引夢貘人',
                    'krabby': '大鉗蟹',
                    'kingler': '巨鉗蟹',
                    'voltorb': '霹靂電球',
                    'electrode': '頑皮雷彈',
                    'exeggcute': '蛋蛋',
                    'exeggutor': '椰蛋樹',
                    'cubone': '卡拉卡拉',
                    'marowak': '嘎啦嘎啦',
                    'hitmonlee': '飛腿郎',
                    'hitmonchan': '快拳郎',
                    'lickitung': '大舌頭',
                    'koffing': '瓦斯彈',
                    'weezing': '雙彈瓦斯',
                    'rhyhorn': '獨角犀牛',
                    'rhydon': '鑽角犀獸',
                    'chansey': '吉利蛋',
                    'tangela': '蔓藤怪',
                    'kangaskhan': '袋獸',
                    'horsea': '墨海馬',
                    'seadra': '海刺龍',
                    'goldeen': '角金魚',
                    'seaking': '金魚王',
                    'staryu': '海星星',
                    'starmie': '寶石海星',
                    'mr-mime': '魔牆人偶',
                    'scyther': '飛天螳螂',
                    'jynx': '迷唇姐',
                    'electabuzz': '電擊獸',
                    'magmar': '鴨嘴火獸',
                    'pinsir': '凱羅斯',
                    'tauros': '肯泰羅',
                    'magikarp': '鯉魚王',
                    'gyarados': '暴鯉龍',
                    'lapras': '拉普拉斯',
                    'ditto': '百變怪',
                    'eevee': '伊布',
                    'vaporeon': '水伊布',
                    'jolteon': '雷伊布',
                    'flareon': '火伊布',
                    'porygon': '3D龍',
                    'omanyte': '菊石獸',
                    'omastar': '多刺菊石獸',
                    'kabuto': '化石盔',
                    'kabutops': '鐮刀盔',
                    'aerodactyl': '化石翼龍',
                    'snorlax': '卡比獸',
                    'articuno': '急凍鳥',
                    'zapdos': '閃電鳥',
                    'moltres': '火焰鳥',
                    'dratini': '迷你龍',
                    'dragonair': '哈克龍',
                    'dragonite': '快龍',
                    'mewtwo': '超夢',
                    'mew': '夢幻',
                    // 第二世代寶可夢 (151-251)
                    'chikorita': '菊草葉',
                    'bayleef': '月桂葉',
                    'meganium': '大竺葵',
                    'cyndaquil': '火球鼠',
                    'quilava': '火岩鼠',
                    'typhlosion': '火暴獸',
                    'totodile': '小鋸鱷',
                    'croconaw': '藍鱷',
                    'feraligatr': '大力鱷',
                    'sentret': '尾立',
                    'furret': '大尾立',
                    'hoothoot': '咕咕',
                    'noctowl': '貓頭夜鷹',
                    'ledyba': '芭瓢蟲',
                    'ledian': '安瓢蟲',
                    'spinarak': '圓絲蛛',
                    'ariados': '阿利多斯',
                    'crobat': '叉字蝠',
                    'chinchou': '燈籠魚',
                    'lanturn': '電燈怪',
                    'pichu': '皮丘',
                    'cleffa': '皮寶寶',
                    'igglybuff': '胖丁寶寶',
                    'togepi': '波克比',
                    'togetic': '波克基古',
                    'natu': '天然雀',
                    'xatu': '天然鳥',
                    'mareep': '咩利羊',
                    'flaaffy': '茸茸羊',
                    'ampharos': '電龍',
                    'bellossom': '美麗花',
                    'marill': '瑪力露',
                    'azumarill': '瑪力露麗',
                    'sudowoodo': '樹才怪',
                    'politoed': '蚊香蛙皇',
                    'hoppip': '毽子草',
                    'skiploom': '毽子花',
                    'jumpluff': '毽子棉',
                    'aipom': '長尾怪手',
                    'sunkern': '向日種子',
                    'sunflora': '向日花怪',
                    'yanma': '蜻蜻蜓',
                    'wooper': '烏波',
                    'quagsire': '沼王',
                    'espeon': '太陽伊布',
                    'umbreon': '月亮伊布',
                    'murkrow': '黑暗鴉',
                    'slowking': '呆呆王',
                    'misdreavus': '夢妖',
                    'unown': '未知圖騰',
                    'wobbuffet': '果然翁',
                    'girafarig': '麒麟奇',
                    'pineco': '榛果球',
                    'forretress': '佛烈托斯',
                    'dunsparce': '土龍弟弟',
                    'gligar': '天蠍',
                    'steelix': '大鋼蛇',
                    'snubbull': '布魯',
                    'granbull': '布魯皇',
                    'qwilfish': '千針魚',
                    'scizor': '巨鉗螳螂',
                    'shuckle': '壺壺',
                    'heracross': '赫拉克羅斯',
                    'sneasel': '狃拉',
                    'teddiursa': '熊寶寶',
                    'ursaring': '圈圈熊',
                    'slugma': '熔岩蟲',
                    'magcargo': '熔岩蝸牛',
                    'swinub': '小山豬',
                    'piloswine': '長毛豬',
                    'corsola': '太陽珊瑚',
                    'remoraid': '鐵炮魚',
                    'octillery': '章魚桶',
                    'delibird': '信使鳥',
                    'mantine': '巨翅飛魚',
                    'skarmory': '盔甲鳥',
                    'houndour': '戴魯比',
                    'houndoom': '黑魯加',
                    'kingdra': '刺龍王',
                    'phanpy': '小小象',
                    'donphan': '頓甲',
                    'porygon2': '3D龍2',
                    'stantler': '驚角鹿',
                    'smeargle': '圖圖犬',
                    'tyrogue': '無畏小子',
                    'hitmontop': '戰舞郎',
                    'smoochum': '迷唇娃',
                    'elekid': '電擊怪',
                    'magby': '鴨嘴寶寶',
                    'miltank': '大奶罐',
                    'blissey': '幸福蛋',
                    'raikou': '雷公',
                    'entei': '炎帝',
                    'suicune': '水君',
                    'larvitar': '幼基拉斯',
                    'pupitar': '沙基拉斯',
                    'tyranitar': '班基拉斯',
                    'lugia': '洛奇亞',
                    'ho-oh': '鳳王',
                    'celebi': '時拉比',
                    // 自訂寶可夢
                    'hsin': '昕咪',
                    'dorudo': '阿嘟'
                };
                
                this.init();
            }

            async init() {
                this.bindEvents();
                this.setupNetworkListeners();
                this.showLoadingOptions();
            }

            setupNetworkListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.hideOfflineIndicator();
                    console.log('網路連線已恢復');
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.showOfflineIndicator();
                    console.log('網路連線中斷，進入離線模式');
                });

                // 初始化時檢查網路狀態
                if (!this.isOnline) {
                    this.showOfflineIndicator();
                }
            }

            showOfflineIndicator() {
                const existing = document.querySelector('.offline-indicator');
                if (existing) return;

                const indicator = document.createElement('div');
                indicator.className = 'offline-indicator';
                indicator.textContent = '🔌 離線模式';
                document.body.appendChild(indicator);
            }

            hideOfflineIndicator() {
                const indicator = document.querySelector('.offline-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }

            showLoadingOptions() {
                document.getElementById('loadingOptions').style.display = 'block';
                this.pokemonGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;"><p>請選擇載入範圍以開始瀏覽寶可夢圖鑑</p></div>';
            }

            bindEvents() {
                this.searchInput.addEventListener('input', (e) => {
                    this.searchPokemon(e.target.value);
                });

                document.getElementById('loadPartial').addEventListener('click', () => {
                    this.totalCount = 251;
                    this.startLoading('第1-2代');
                });

                document.getElementById('loadMore').addEventListener('click', () => {
                    this.totalCount = 493;
                    this.startLoading('第1-4代');
                });

                document.getElementById('loadAll').addEventListener('click', () => {
                    this.totalCount = 1025;
                    this.startLoading('全部世代');
                });
            }

            async startLoading(range) {
                // 禁用所有按鈕
                document.querySelectorAll('.load-btn').forEach(btn => btn.disabled = true);
                document.getElementById('loadingOptions').style.display = 'none';
                
                console.log(`開始載入${range}寶可夢，總數: ${this.totalCount}`);
                
                await this.loadPokemonData();
                this.displayAllPokemon();
            }

            async loadPokemonData() {
                this.loading.style.display = 'block';
                try {
                    // 分批載入以提升用戶體驗
                    const batchSize = 20;
                    const apiPokemon = [];
                    
                    for (let i = 1; i <= this.totalCount; i += batchSize) {
                        const batch = [];
                        const end = Math.min(i + batchSize - 1, this.totalCount);
                        
                        for (let j = i; j <= end; j++) {
                            batch.push(this.fetchPokemon(j));
                        }
                        
                        const batchResults = await Promise.all(batch);
                        apiPokemon.push(...batchResults);
                        
                        this.loadedCount = Math.min(i + batchSize - 1, this.totalCount);
                        this.updateLoadingProgress();
                        
                        // 短暂停頓以避免阻塞UI
                        if (i + batchSize <= this.totalCount) {
                            await new Promise(resolve => setTimeout(resolve, 50));
                        }
                    }
                    
                    // 加入自訂寶可夢（編號1026-1027）
                    const customPokemon = [
                        {
                            id: 1026,
                            name: 'hsin',
                            chineseName: '昕咪',
                            image: './hsin.png',
                            types: ['custom']
                        },
                        {
                            id: 1027,
                            name: 'dorudo',
                            chineseName: '阿嘟',
                            image: './dorudo.png',
                            types: ['custom']
                        }
                    ];
                    
                    this.allPokemon = [...apiPokemon, ...customPokemon];
                    this.pokemonData = this.allPokemon;
                } catch (error) {
                    console.error('載入寶可夢數據失敗:', error);
                } finally {
                    this.loading.style.display = 'none';
                }
            }

            updateLoadingProgress() {
                const progress = (this.loadedCount / this.totalCount) * 100;
                this.loadingBar.style.width = `${progress}%`;
                this.loadingText.textContent = `${this.loadedCount} / ${this.totalCount}`;
            }

            async fetchPokemon(id) {
                try {
                    const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    const pokemon = await response.json();
                    
                    return {
                        id: pokemon.id,
                        name: pokemon.name,
                        chineseName: this.chineseNames[pokemon.name] || pokemon.name,
                        image: pokemon.sprites.front_default,
                        types: pokemon.types.map(type => type.type.name)
                    };
                } catch (error) {
                    console.error(`載入寶可夢 ${id} 失敗:`, error);
                    // 返回一個占位物件而不是null
                    return {
                        id: id,
                        name: `pokemon-${id}`,
                        chineseName: `寶可夢 #${id}`,
                        image: null,
                        types: ['unknown']
                    };
                }
            }

            searchPokemon(query) {
                if (!query.trim()) {
                    this.displayAllPokemon();
                    return;
                }

                const filteredPokemon = this.allPokemon.filter(pokemon => {
                    if (!pokemon) return false;
                    
                    const queryLower = query.toLowerCase();
                    return pokemon.name.toLowerCase().includes(queryLower) ||
                           pokemon.chineseName.includes(query) ||
                           pokemon.id.toString().includes(query);
                });

                this.displayPokemon(filteredPokemon);
            }

            displayAllPokemon() {
                this.displayPokemon(this.allPokemon);
            }

            displayPokemon(pokemonList) {
                this.pokemonGrid.innerHTML = '';
                this.noResults.style.display = 'none';

                const validPokemon = pokemonList.filter(pokemon => pokemon !== null);

                if (validPokemon.length === 0) {
                    this.noResults.style.display = 'block';
                    return;
                }

                validPokemon.forEach(pokemon => {
                    const pokemonCard = this.createPokemonCard(pokemon);
                    this.pokemonGrid.appendChild(pokemonCard);
                });
            }

            createPokemonCard(pokemon) {
                const card = document.createElement('div');
                card.className = 'pokemon-card';
                
                card.innerHTML = `
                    <div class="pokemon-image">
                        <img src="${pokemon.image}" alt="${pokemon.chineseName}" onerror="this.src='data:image/svg+xml,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;70&quot; height=&quot;70&quot; viewBox=&quot;0 0 70 70&quot;><rect width=&quot;70&quot; height=&quot;70&quot; fill=&quot;%23f0f0f0&quot;/><text x=&quot;35&quot; y=&quot;40&quot; text-anchor=&quot;middle&quot; font-family=&quot;Arial&quot; font-size=&quot;12&quot; fill=&quot;%23999&quot;>%3F</text></svg>'">
                    </div>
                    <div class="pokemon-name">${pokemon.chineseName}</div>
                    <div class="pokemon-name-en">${pokemon.name}</div>
                    <div class="pokemon-id">#${pokemon.id.toString().padStart(3, '0')}</div>
                `;

                card.addEventListener('click', () => {
                    this.showPokemonDetails(pokemon);
                });

                return card;
            }

            showPokemonDetails(pokemon) {
                const typesText = pokemon.types.map(type => this.typeTranslations[type] || type).join('、');
                alert(`寶可夢詳細資訊:\n\n中文名稱: ${pokemon.chineseName}\n英文名稱: ${pokemon.name}\n編號: #${pokemon.id.toString().padStart(4, '0')}\n屬性: ${typesText}`);
            }
        }

        // PWA Service Worker 註冊
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js');
                    console.log('Service Worker 註冊成功:', registration.scope);
                    
                    // 監聴更新
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showUpdateNotification();
                            }
                        });
                    });
                } catch (error) {
                    console.error('Service Worker 註冊失敗:', error);
                }
            });
        }

        // PWA 安裝提示
        let deferredPrompt;
        const installButton = document.createElement('button');
        installButton.textContent = '📱 安裝應用程式';
        installButton.className = 'install-btn';
        installButton.style.display = 'none';
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'inline-block';
        });
        
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('安裝結果:', outcome);
                deferredPrompt = null;
                installButton.style.display = 'none';
            }
        });

        // 更新通知
        function showUpdateNotification() {
            const updateBanner = document.createElement('div');
            updateBanner.className = 'update-banner';
            updateBanner.innerHTML = `
                <span>🆕 有新版本可用</span>
                <button onclick="location.reload()">更新</button>
            `;
            document.body.insertBefore(updateBanner, document.body.firstChild);
        }

        // 啟動應用程式
        document.addEventListener('DOMContentLoaded', () => {
            // 加入安裝按鈕
            const container = document.querySelector('.container');
            const title = container.querySelector('h1');
            title.appendChild(installButton);
            
            new PokemonSearch();
        });
    </script>
</body>
</html>