<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢æœå°‹å™¨ - Pokemon Search</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="å®Œæ•´çš„å¯¶å¯å¤¢åœ–é‘‘æœå°‹å·¥å…·ï¼Œæ”¯æ´é›¢ç·šä½¿ç”¨ï¼ŒåŒ…å«1025+éš»å¯¶å¯å¤¢">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å¯¶å¯å¤¢åœ–é‘‘">
    <meta name="msapplication-TileColor" content="#764ba2">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/icon-192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/icon-16.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .search-box {
            text-align: center;
            margin-bottom: 30px;
        }

        #searchInput {
            width: 60%;
            max-width: 400px;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s;
        }

        #searchInput:focus {
            border-color: #667eea;
        }

        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .pokemon-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .pokemon-image {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pokemon-image img {
            max-width: 70px;
            max-height: 70px;
        }

        .pokemon-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .pokemon-name-en {
            color: #666;
            font-size: 0.9em;
        }

        .pokemon-id {
            color: #999;
            font-size: 0.8em;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            color: #666;
            margin: 20px 0;
            font-size: 1.1em;
        }

        .loading-progress {
            width: 60%;
            max-width: 400px;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 10px auto;
            overflow: hidden;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .loading-text {
            margin-top: 10px;
            font-size: 0.9em;
        }

        .no-results {
            text-align: center;
            color: #999;
            margin: 40px 0;
            font-size: 1.2em;
        }

        .load-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 18px;
            margin: 5px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .load-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .load-btn:active {
            transform: translateY(0);
        }

        .load-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* PWA æ¨£å¼ */
        .install-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            padding: 8px 16px;
            margin-left: 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
            transition: transform 0.2s;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .install-btn:hover {
            transform: scale(1.05);
        }

        .update-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #4CAF50;
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .update-banner button {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            cursor: pointer;
        }

        /* é›¢ç·šæŒ‡ç¤ºå™¨ */
        .offline-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #ff9800;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .install-btn {
                display: block;
                margin: 10px auto 0;
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å¯¶å¯å¤¢æœå°‹å™¨</h1>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="æœå°‹å¯¶å¯å¤¢åç¨± (ä¸­æ–‡/è‹±æ–‡/ç·¨è™Ÿ)..." />
            <div id="loadingOptions" style="margin-top: 15px;">
                <div style="margin-bottom: 10px; color: #666; font-size: 0.9em;">é¸æ“‡è¼‰å…¥ç¯„åœï¼š</div>
                <button id="loadPartial" class="load-btn">è¼‰å…¥å‰251éš»ï¼ˆç¬¬1-2ä»£ï¼‰</button>
                <button id="loadMore" class="load-btn">è¼‰å…¥å‰493éš»ï¼ˆç¬¬1-4ä»£ï¼‰</button>
                <button id="loadAll" class="load-btn">è¼‰å…¥å…¨1025éš»ï¼ˆå…¨éƒ¨ï¼‰</button>
            </div>
        </div>
        <div id="loading" class="loading" style="display: none;">
            <div>è¼‰å…¥å¯¶å¯å¤¢è³‡æ–™ä¸­...</div>
            <div class="loading-progress">
                <div id="loadingBar" class="loading-bar"></div>
            </div>
            <div id="loadingText" class="loading-text">0 / 251</div>
        </div>
        <div id="pokemonGrid" class="pokemon-grid"></div>
        <div id="noResults" class="no-results" style="display: none;">æ‰¾ä¸åˆ°ç›¸ç¬¦çš„å¯¶å¯å¤¢</div>
    </div>

    <script>
        class PokemonSearch {
            constructor() {
                this.pokemonData = [];
                this.allPokemon = [];
                this.loadedCount = 0;
                this.totalCount = 251; // åˆå§‹è¼‰å…¥æ•¸é‡
                this.maxCount = 1025; // æœ€å¤§æ•¸é‡
                this.isOnline = navigator.onLine;
                this.searchInput = document.getElementById('searchInput');
                this.pokemonGrid = document.getElementById('pokemonGrid');
                this.loading = document.getElementById('loading');
                this.loadingBar = document.getElementById('loadingBar');
                this.loadingText = document.getElementById('loadingText');
                this.noResults = document.getElementById('noResults');
                
                // å®Œæ•´ä¸­æ–‡åç¨±å°ç…§è¡¨ï¼ˆç¬¬ä¸€ã€äºŒä»£å¯¶å¯å¤¢ï¼‰
                this.chineseNames = {
                    'bulbasaur': 'å¦™è›™ç¨®å­',
                    'ivysaur': 'å¦™è›™è‰',
                    'venusaur': 'å¦™è›™èŠ±',
                    'charmander': 'å°ç«é¾',
                    'charmeleon': 'ç«æé¾',
                    'charizard': 'å™´ç«é¾',
                    'squirtle': 'å‚‘å°¼é¾œ',
                    'wartortle': 'å¡å’ªé¾œ',
                    'blastoise': 'æ°´ç®­é¾œ',
                    'caterpie': 'ç¶ æ¯›èŸ²',
                    'metapod': 'éµç”²è›¹',
                    'butterfree': 'å·´å¤§è¶',
                    'weedle': 'ç¨è§’èŸ²',
                    'kakuna': 'éµæ®¼è›¹',
                    'beedrill': 'å¤§é‡èœ‚',
                    'pidgey': 'æ³¢æ³¢',
                    'pidgeotto': 'æ¯”æ¯”é³¥',
                    'pidgeot': 'å¤§æ¯”é³¥',
                    'rattata': 'å°æ‹‰é”',
                    'raticate': 'æ‹‰é”',
                    'spearow': 'çƒˆé›€',
                    'fearow': 'å¤§å˜´é›€',
                    'ekans': 'é˜¿æŸè›‡',
                    'arbok': 'é˜¿æŸæ€ª',
                    'pikachu': 'çš®å¡ä¸˜',
                    'raichu': 'é›·ä¸˜',
                    'sandshrew': 'ç©¿å±±é¼ ',
                    'sandslash': 'ç©¿å±±ç‹',
                    'nidoran-f': 'å°¼å¤šè˜­',
                    'nidorina': 'å°¼å¤šå¨œ',
                    'nidoqueen': 'å°¼å¤šå',
                    'nidoran-m': 'å°¼å¤šæœ—',
                    'nidorino': 'å°¼å¤šåŠ›è«¾',
                    'nidoking': 'å°¼å¤šç‹',
                    'clefairy': 'çš®çš®',
                    'clefable': 'çš®å¯è¥¿',
                    'vulpix': 'å…­å°¾',
                    'ninetales': 'ä¹å°¾',
                    'jigglypuff': 'èƒ–ä¸',
                    'wigglytuff': 'èƒ–å¯ä¸',
                    'zubat': 'è¶…éŸ³è ',
                    'golbat': 'å¤§å˜´è ',
                    'oddish': 'èµ°è·¯è‰',
                    'gloom': 'è‡­è‡­èŠ±',
                    'vileplume': 'éœ¸ç‹èŠ±',
                    'paras': 'æ´¾æ‹‰æ–¯',
                    'parasect': 'æ´¾æ‹‰æ–¯ç‰¹',
                    'venonat': 'æ¯›çƒ',
                    'venomoth': 'æ‘©é­¯è›¾',
                    'diglett': 'åœ°é¼ ',
                    'dugtrio': 'ä¸‰åœ°é¼ ',
                    'meowth': 'å–µå–µ',
                    'persian': 'è²“è€å¤§',
                    'psyduck': 'å¯é”é´¨',
                    'golduck': 'å“¥é”é´¨',
                    'mankey': 'çŒ´æ€ª',
                    'primeape': 'ç«çˆ†çŒ´',
                    'growlithe': 'å¡è’‚ç‹—',
                    'arcanine': 'é¢¨é€Ÿç‹—',
                    'poliwag': 'èšŠé¦™èŒèšª',
                    'poliwhirl': 'èšŠé¦™å›',
                    'poliwrath': 'èšŠé¦™æ³³å£«',
                    'abra': 'å‡±è¥¿',
                    'kadabra': 'å‹‡åŸºæ‹‰',
                    'alakazam': 'èƒ¡åœ°',
                    'machop': 'è…•åŠ›',
                    'machoke': 'è±ªåŠ›',
                    'machamp': 'æ€ªåŠ›',
                    'bellsprout': 'å–‡å­èŠ½',
                    'weepinbell': 'å£å‘†èŠ±',
                    'victreebel': 'å¤§é£ŸèŠ±',
                    'tentacool': 'ç‘ªç‘™æ°´æ¯',
                    'tentacruel': 'æ¯’åˆºæ°´æ¯',
                    'geodude': 'å°æ‹³çŸ³',
                    'graveler': 'éš†éš†çŸ³',
                    'golem': 'éš†éš†å²©',
                    'ponyta': 'å°ç«é¦¬',
                    'rapidash': 'çƒˆç„°é¦¬',
                    'slowpoke': 'å‘†å‘†ç¸',
                    'slowbro': 'å‘†æ®¼ç¸',
                    'magnemite': 'å°ç£æ€ª',
                    'magneton': 'ä¸‰åˆä¸€ç£æ€ª',
                    'farfetchd': 'å¤§è”¥é´¨',
                    'doduo': 'å˜Ÿå˜Ÿ',
                    'dodrio': 'å˜Ÿå˜Ÿåˆ©',
                    'seel': 'å°æµ·ç…',
                    'dewgong': 'ç™½æµ·ç…',
                    'grimer': 'è‡­æ³¥',
                    'muk': 'è‡­è‡­æ³¥',
                    'shellder': 'å¤§èˆŒè²',
                    'cloyster': 'åˆºç”²è²',
                    'gastly': 'é¬¼æ–¯',
                    'haunter': 'é¬¼æ–¯é€š',
                    'gengar': 'è€¿é¬¼',
                    'onix': 'å¤§å²©è›‡',
                    'drowzee': 'å‚¬çœ è²˜',
                    'hypno': 'å¼•å¤¢è²˜äºº',
                    'krabby': 'å¤§é‰—èŸ¹',
                    'kingler': 'å·¨é‰—èŸ¹',
                    'voltorb': 'éœ¹é‚é›»çƒ',
                    'electrode': 'é ‘çš®é›·å½ˆ',
                    'exeggcute': 'è›‹è›‹',
                    'exeggutor': 'æ¤°è›‹æ¨¹',
                    'cubone': 'å¡æ‹‰å¡æ‹‰',
                    'marowak': 'å˜å•¦å˜å•¦',
                    'hitmonlee': 'é£›è…¿éƒ',
                    'hitmonchan': 'å¿«æ‹³éƒ',
                    'lickitung': 'å¤§èˆŒé ­',
                    'koffing': 'ç“¦æ–¯å½ˆ',
                    'weezing': 'é›™å½ˆç“¦æ–¯',
                    'rhyhorn': 'ç¨è§’çŠ€ç‰›',
                    'rhydon': 'é‘½è§’çŠ€ç¸',
                    'chansey': 'å‰åˆ©è›‹',
                    'tangela': 'è”“è—¤æ€ª',
                    'kangaskhan': 'è¢‹ç¸',
                    'horsea': 'å¢¨æµ·é¦¬',
                    'seadra': 'æµ·åˆºé¾',
                    'goldeen': 'è§’é‡‘é­š',
                    'seaking': 'é‡‘é­šç‹',
                    'staryu': 'æµ·æ˜Ÿæ˜Ÿ',
                    'starmie': 'å¯¶çŸ³æµ·æ˜Ÿ',
                    'mr-mime': 'é­”ç‰†äººå¶',
                    'scyther': 'é£›å¤©è³è‚',
                    'jynx': 'è¿·å”‡å§',
                    'electabuzz': 'é›»æ“Šç¸',
                    'magmar': 'é´¨å˜´ç«ç¸',
                    'pinsir': 'å‡±ç¾…æ–¯',
                    'tauros': 'è‚¯æ³°ç¾…',
                    'magikarp': 'é¯‰é­šç‹',
                    'gyarados': 'æš´é¯‰é¾',
                    'lapras': 'æ‹‰æ™®æ‹‰æ–¯',
                    'ditto': 'ç™¾è®Šæ€ª',
                    'eevee': 'ä¼Šå¸ƒ',
                    'vaporeon': 'æ°´ä¼Šå¸ƒ',
                    'jolteon': 'é›·ä¼Šå¸ƒ',
                    'flareon': 'ç«ä¼Šå¸ƒ',
                    'porygon': '3Dé¾',
                    'omanyte': 'èŠçŸ³ç¸',
                    'omastar': 'å¤šåˆºèŠçŸ³ç¸',
                    'kabuto': 'åŒ–çŸ³ç›”',
                    'kabutops': 'é®åˆ€ç›”',
                    'aerodactyl': 'åŒ–çŸ³ç¿¼é¾',
                    'snorlax': 'å¡æ¯”ç¸',
                    'articuno': 'æ€¥å‡é³¥',
                    'zapdos': 'é–ƒé›»é³¥',
                    'moltres': 'ç«ç„°é³¥',
                    'dratini': 'è¿·ä½ é¾',
                    'dragonair': 'å“ˆå…‹é¾',
                    'dragonite': 'å¿«é¾',
                    'mewtwo': 'è¶…å¤¢',
                    'mew': 'å¤¢å¹»',
                    // ç¬¬äºŒä¸–ä»£å¯¶å¯å¤¢ (151-251)
                    'chikorita': 'èŠè‰è‘‰',
                    'bayleef': 'æœˆæ¡‚è‘‰',
                    'meganium': 'å¤§ç«ºè‘µ',
                    'cyndaquil': 'ç«çƒé¼ ',
                    'quilava': 'ç«å²©é¼ ',
                    'typhlosion': 'ç«æš´ç¸',
                    'totodile': 'å°é‹¸é±·',
                    'croconaw': 'è—é±·',
                    'feraligatr': 'å¤§åŠ›é±·',
                    'sentret': 'å°¾ç«‹',
                    'furret': 'å¤§å°¾ç«‹',
                    'hoothoot': 'å’•å’•',
                    'noctowl': 'è²“é ­å¤œé·¹',
                    'ledyba': 'èŠ­ç“¢èŸ²',
                    'ledian': 'å®‰ç“¢èŸ²',
                    'spinarak': 'åœ“çµ²è››',
                    'ariados': 'é˜¿åˆ©å¤šæ–¯',
                    'crobat': 'å‰å­—è ',
                    'chinchou': 'ç‡ˆç± é­š',
                    'lanturn': 'é›»ç‡ˆæ€ª',
                    'pichu': 'çš®ä¸˜',
                    'cleffa': 'çš®å¯¶å¯¶',
                    'igglybuff': 'èƒ–ä¸å¯¶å¯¶',
                    'togepi': 'æ³¢å…‹æ¯”',
                    'togetic': 'æ³¢å…‹åŸºå¤',
                    'natu': 'å¤©ç„¶é›€',
                    'xatu': 'å¤©ç„¶é³¥',
                    'mareep': 'å’©åˆ©ç¾Š',
                    'flaaffy': 'èŒ¸èŒ¸ç¾Š',
                    'ampharos': 'é›»é¾',
                    'bellossom': 'ç¾éº—èŠ±',
                    'marill': 'ç‘ªåŠ›éœ²',
                    'azumarill': 'ç‘ªåŠ›éœ²éº—',
                    'sudowoodo': 'æ¨¹æ‰æ€ª',
                    'politoed': 'èšŠé¦™è›™çš‡',
                    'hoppip': 'æ¯½å­è‰',
                    'skiploom': 'æ¯½å­èŠ±',
                    'jumpluff': 'æ¯½å­æ£‰',
                    'aipom': 'é•·å°¾æ€ªæ‰‹',
                    'sunkern': 'å‘æ—¥ç¨®å­',
                    'sunflora': 'å‘æ—¥èŠ±æ€ª',
                    'yanma': 'èœ»èœ»èœ“',
                    'wooper': 'çƒæ³¢',
                    'quagsire': 'æ²¼ç‹',
                    'espeon': 'å¤ªé™½ä¼Šå¸ƒ',
                    'umbreon': 'æœˆäº®ä¼Šå¸ƒ',
                    'murkrow': 'é»‘æš—é´‰',
                    'slowking': 'å‘†å‘†ç‹',
                    'misdreavus': 'å¤¢å¦–',
                    'unown': 'æœªçŸ¥åœ–é¨°',
                    'wobbuffet': 'æœç„¶ç¿',
                    'girafarig': 'éº’éºŸå¥‡',
                    'pineco': 'æ¦›æœçƒ',
                    'forretress': 'ä½›çƒˆæ‰˜æ–¯',
                    'dunsparce': 'åœŸé¾å¼Ÿå¼Ÿ',
                    'gligar': 'å¤©è ',
                    'steelix': 'å¤§é‹¼è›‡',
                    'snubbull': 'å¸ƒé­¯',
                    'granbull': 'å¸ƒé­¯çš‡',
                    'qwilfish': 'åƒé‡é­š',
                    'scizor': 'å·¨é‰—è³è‚',
                    'shuckle': 'å£ºå£º',
                    'heracross': 'èµ«æ‹‰å…‹ç¾…æ–¯',
                    'sneasel': 'ç‹ƒæ‹‰',
                    'teddiursa': 'ç†Šå¯¶å¯¶',
                    'ursaring': 'åœˆåœˆç†Š',
                    'slugma': 'ç†”å²©èŸ²',
                    'magcargo': 'ç†”å²©è¸ç‰›',
                    'swinub': 'å°å±±è±¬',
                    'piloswine': 'é•·æ¯›è±¬',
                    'corsola': 'å¤ªé™½çŠç‘š',
                    'remoraid': 'éµç‚®é­š',
                    'octillery': 'ç« é­šæ¡¶',
                    'delibird': 'ä¿¡ä½¿é³¥',
                    'mantine': 'å·¨ç¿…é£›é­š',
                    'skarmory': 'ç›”ç”²é³¥',
                    'houndour': 'æˆ´é­¯æ¯”',
                    'houndoom': 'é»‘é­¯åŠ ',
                    'kingdra': 'åˆºé¾ç‹',
                    'phanpy': 'å°å°è±¡',
                    'donphan': 'é “ç”²',
                    'porygon2': '3Dé¾2',
                    'stantler': 'é©šè§’é¹¿',
                    'smeargle': 'åœ–åœ–çŠ¬',
                    'tyrogue': 'ç„¡ç•å°å­',
                    'hitmontop': 'æˆ°èˆéƒ',
                    'smoochum': 'è¿·å”‡å¨ƒ',
                    'elekid': 'é›»æ“Šæ€ª',
                    'magby': 'é´¨å˜´å¯¶å¯¶',
                    'miltank': 'å¤§å¥¶ç½',
                    'blissey': 'å¹¸ç¦è›‹',
                    'raikou': 'é›·å…¬',
                    'entei': 'ç‚å¸',
                    'suicune': 'æ°´å›',
                    'larvitar': 'å¹¼åŸºæ‹‰æ–¯',
                    'pupitar': 'æ²™åŸºæ‹‰æ–¯',
                    'tyranitar': 'ç­åŸºæ‹‰æ–¯',
                    'lugia': 'æ´›å¥‡äº',
                    'ho-oh': 'é³³ç‹',
                    'celebi': 'æ™‚æ‹‰æ¯”',
                    // è‡ªè¨‚å¯¶å¯å¤¢
                    'hsin': 'æ˜•å’ª',
                    'dorudo': 'é˜¿å˜Ÿ'
                };
                
                this.init();
            }

            async init() {
                this.bindEvents();
                this.setupNetworkListeners();
                this.showLoadingOptions();
            }

            setupNetworkListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.hideOfflineIndicator();
                    console.log('ç¶²è·¯é€£ç·šå·²æ¢å¾©');
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.showOfflineIndicator();
                    console.log('ç¶²è·¯é€£ç·šä¸­æ–·ï¼Œé€²å…¥é›¢ç·šæ¨¡å¼');
                });

                // åˆå§‹åŒ–æ™‚æª¢æŸ¥ç¶²è·¯ç‹€æ…‹
                if (!this.isOnline) {
                    this.showOfflineIndicator();
                }
            }

            showOfflineIndicator() {
                const existing = document.querySelector('.offline-indicator');
                if (existing) return;

                const indicator = document.createElement('div');
                indicator.className = 'offline-indicator';
                indicator.textContent = 'ğŸ”Œ é›¢ç·šæ¨¡å¼';
                document.body.appendChild(indicator);
            }

            hideOfflineIndicator() {
                const indicator = document.querySelector('.offline-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }

            showLoadingOptions() {
                document.getElementById('loadingOptions').style.display = 'block';
                this.pokemonGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;"><p>è«‹é¸æ“‡è¼‰å…¥ç¯„åœä»¥é–‹å§‹ç€è¦½å¯¶å¯å¤¢åœ–é‘‘</p></div>';
            }

            bindEvents() {
                this.searchInput.addEventListener('input', (e) => {
                    this.searchPokemon(e.target.value);
                });

                document.getElementById('loadPartial').addEventListener('click', () => {
                    this.totalCount = 251;
                    this.startLoading('ç¬¬1-2ä»£');
                });

                document.getElementById('loadMore').addEventListener('click', () => {
                    this.totalCount = 493;
                    this.startLoading('ç¬¬1-4ä»£');
                });

                document.getElementById('loadAll').addEventListener('click', () => {
                    this.totalCount = 1025;
                    this.startLoading('å…¨éƒ¨ä¸–ä»£');
                });
            }

            async startLoading(range) {
                // ç¦ç”¨æ‰€æœ‰æŒ‰éˆ•
                document.querySelectorAll('.load-btn').forEach(btn => btn.disabled = true);
                document.getElementById('loadingOptions').style.display = 'none';
                
                console.log(`é–‹å§‹è¼‰å…¥${range}å¯¶å¯å¤¢ï¼Œç¸½æ•¸: ${this.totalCount}`);
                
                await this.loadPokemonData();
                this.displayAllPokemon();
            }

            async loadPokemonData() {
                this.loading.style.display = 'block';
                try {
                    // åˆ†æ‰¹è¼‰å…¥ä»¥æå‡ç”¨æˆ¶é«”é©—
                    const batchSize = 20;
                    const apiPokemon = [];
                    
                    for (let i = 1; i <= this.totalCount; i += batchSize) {
                        const batch = [];
                        const end = Math.min(i + batchSize - 1, this.totalCount);
                        
                        for (let j = i; j <= end; j++) {
                            batch.push(this.fetchPokemon(j));
                        }
                        
                        const batchResults = await Promise.all(batch);
                        apiPokemon.push(...batchResults);
                        
                        this.loadedCount = Math.min(i + batchSize - 1, this.totalCount);
                        this.updateLoadingProgress();
                        
                        // çŸ­æš‚åœé “ä»¥é¿å…é˜»å¡UI
                        if (i + batchSize <= this.totalCount) {
                            await new Promise(resolve => setTimeout(resolve, 50));
                        }
                    }
                    
                    // åŠ å…¥è‡ªè¨‚å¯¶å¯å¤¢ï¼ˆç·¨è™Ÿ1026-1027ï¼‰
                    const customPokemon = [
                        {
                            id: 1026,
                            name: 'hsin',
                            chineseName: 'æ˜•å’ª',
                            image: './hsin.png',
                            types: ['custom']
                        },
                        {
                            id: 1027,
                            name: 'dorudo',
                            chineseName: 'é˜¿å˜Ÿ',
                            image: './dorudo.png',
                            types: ['custom']
                        }
                    ];
                    
                    this.allPokemon = [...apiPokemon, ...customPokemon];
                    this.pokemonData = this.allPokemon;
                } catch (error) {
                    console.error('è¼‰å…¥å¯¶å¯å¤¢æ•¸æ“šå¤±æ•—:', error);
                } finally {
                    this.loading.style.display = 'none';
                }
            }

            updateLoadingProgress() {
                const progress = (this.loadedCount / this.totalCount) * 100;
                this.loadingBar.style.width = `${progress}%`;
                this.loadingText.textContent = `${this.loadedCount} / ${this.totalCount}`;
            }

            async fetchPokemon(id) {
                try {
                    const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    const pokemon = await response.json();
                    
                    return {
                        id: pokemon.id,
                        name: pokemon.name,
                        chineseName: this.chineseNames[pokemon.name] || pokemon.name,
                        image: pokemon.sprites.front_default,
                        types: pokemon.types.map(type => type.type.name)
                    };
                } catch (error) {
                    console.error(`è¼‰å…¥å¯¶å¯å¤¢ ${id} å¤±æ•—:`, error);
                    // è¿”å›ä¸€å€‹å ä½ç‰©ä»¶è€Œä¸æ˜¯null
                    return {
                        id: id,
                        name: `pokemon-${id}`,
                        chineseName: `å¯¶å¯å¤¢ #${id}`,
                        image: null,
                        types: ['unknown']
                    };
                }
            }

            searchPokemon(query) {
                if (!query.trim()) {
                    this.displayAllPokemon();
                    return;
                }

                const filteredPokemon = this.allPokemon.filter(pokemon => {
                    if (!pokemon) return false;
                    
                    const queryLower = query.toLowerCase();
                    return pokemon.name.toLowerCase().includes(queryLower) ||
                           pokemon.chineseName.includes(query) ||
                           pokemon.id.toString().includes(query);
                });

                this.displayPokemon(filteredPokemon);
            }

            displayAllPokemon() {
                this.displayPokemon(this.allPokemon);
            }

            displayPokemon(pokemonList) {
                this.pokemonGrid.innerHTML = '';
                this.noResults.style.display = 'none';

                const validPokemon = pokemonList.filter(pokemon => pokemon !== null);

                if (validPokemon.length === 0) {
                    this.noResults.style.display = 'block';
                    return;
                }

                validPokemon.forEach(pokemon => {
                    const pokemonCard = this.createPokemonCard(pokemon);
                    this.pokemonGrid.appendChild(pokemonCard);
                });
            }

            createPokemonCard(pokemon) {
                const card = document.createElement('div');
                card.className = 'pokemon-card';
                
                card.innerHTML = `
                    <div class="pokemon-image">
                        <img src="${pokemon.image}" alt="${pokemon.chineseName}" onerror="this.src='data:image/svg+xml,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;70&quot; height=&quot;70&quot; viewBox=&quot;0 0 70 70&quot;><rect width=&quot;70&quot; height=&quot;70&quot; fill=&quot;%23f0f0f0&quot;/><text x=&quot;35&quot; y=&quot;40&quot; text-anchor=&quot;middle&quot; font-family=&quot;Arial&quot; font-size=&quot;12&quot; fill=&quot;%23999&quot;>%3F</text></svg>'">
                    </div>
                    <div class="pokemon-name">${pokemon.chineseName}</div>
                    <div class="pokemon-name-en">${pokemon.name}</div>
                    <div class="pokemon-id">#${pokemon.id.toString().padStart(3, '0')}</div>
                `;

                card.addEventListener('click', () => {
                    this.showPokemonDetails(pokemon);
                });

                return card;
            }

            showPokemonDetails(pokemon) {
                const typesText = pokemon.types.map(type => this.typeTranslations[type] || type).join('ã€');
                alert(`å¯¶å¯å¤¢è©³ç´°è³‡è¨Š:\n\nä¸­æ–‡åç¨±: ${pokemon.chineseName}\nè‹±æ–‡åç¨±: ${pokemon.name}\nç·¨è™Ÿ: #${pokemon.id.toString().padStart(4, '0')}\nå±¬æ€§: ${typesText}`);
            }
        }

        // PWA Service Worker è¨»å†Š
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js');
                    console.log('Service Worker è¨»å†ŠæˆåŠŸ:', registration.scope);
                    
                    // ç›£è´æ›´æ–°
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showUpdateNotification();
                            }
                        });
                    });
                } catch (error) {
                    console.error('Service Worker è¨»å†Šå¤±æ•—:', error);
                }
            });
        }

        // PWA å®‰è£æç¤º
        let deferredPrompt;
        const installButton = document.createElement('button');
        installButton.textContent = 'ğŸ“± å®‰è£æ‡‰ç”¨ç¨‹å¼';
        installButton.className = 'install-btn';
        installButton.style.display = 'none';
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'inline-block';
        });
        
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('å®‰è£çµæœ:', outcome);
                deferredPrompt = null;
                installButton.style.display = 'none';
            }
        });

        // æ›´æ–°é€šçŸ¥
        function showUpdateNotification() {
            const updateBanner = document.createElement('div');
            updateBanner.className = 'update-banner';
            updateBanner.innerHTML = `
                <span>ğŸ†• æœ‰æ–°ç‰ˆæœ¬å¯ç”¨</span>
                <button onclick="location.reload()">æ›´æ–°</button>
            `;
            document.body.insertBefore(updateBanner, document.body.firstChild);
        }

        // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
        document.addEventListener('DOMContentLoaded', () => {
            // åŠ å…¥å®‰è£æŒ‰éˆ•
            const container = document.querySelector('.container');
            const title = container.querySelector('h1');
            title.appendChild(installButton);
            
            new PokemonSearch();
        });
    </script>
</body>
</html>